<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>python爬虫爬取前程无忧网(https://www.51job.com)指定岗位信息并存入excel数据表中</title>
      <link href="/2021/08/24/spider_51job/"/>
      <url>/2021/08/24/spider_51job/</url>
      
        <content type="html"><![CDATA[<h2 id="网页分析"><a href="#网页分析" class="headerlink" title="网页分析"></a>网页分析</h2><p>爬虫爬取数据首先要解析网页，要知道数据存放的地方是直接写在dom节点中，还是写在script标签中又或者是通过JavaScript文件来获取并加载数据。<br>在前程无忧网(<code>https://www.51job.com</code>)中搜索职位前端，ctrl+u进入网页源码，可以发现在dom节点中是找不到相关数据的，在源码中ctrl+f进入网页随便搜索看到的一家公司名字，如下图所示：<br><a href="https://imgtu.com/i/hAJ1pj"><img src="https://z3.ax1x.com/2021/08/24/hAJ1pj.png"></a><br><a href="https://imgtu.com/i/hAJMtg"><img src="https://z3.ax1x.com/2021/08/24/hAJMtg.jpg"></a><br>可以发现数据全部存放在该源码中的一个<code>&lt;script type=&quot;text/javascript&quot;&gt;&lt;script&gt;</code>标签中，而非硬编码直接写在dom节点中，要获取数据也就是要获取到这个script标签，好了，网页分析就到这里，接下来直接上代码。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 引入相关第三方依赖，如果没有安装则要提前安装</span><span class="token keyword">import</span> requests<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree<span class="token keyword">import</span> xlwt<span class="token keyword">import</span> re<span class="token keyword">import</span> ast<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token comment"># 设置请求头</span>headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 Edg/87.0.664.57'</span><span class="token punctuation">&#125;</span><span class="token comment"># 输入岗位名称并转urlencode编码</span>job<span class="token operator">=</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入您要在前程无忧网爬取的岗位名称：'</span><span class="token punctuation">)</span>job_urlencode<span class="token operator">=</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token comment"># 创建ecxel文件，并在excel文件中新建一张工作表sheet1</span>workbook<span class="token operator">=</span>xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>sheet1 <span class="token operator">=</span> workbook<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span><span class="token string">'&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#设置工作表sheet1的列名及列宽</span><span class="token keyword">def</span> <span class="token function">ceate_sheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'职位名称'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'公司名字'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'工资'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'地址'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'发布日期'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'公司性质'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'职位福利'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'行业'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'公司规模'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'投递链接'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'公司链接'</span><span class="token punctuation">)</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">20</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">30</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">10</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">15</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">15</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">15</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">60</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">20</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">15</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">30</span>    sheet1<span class="token punctuation">.</span>col<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token comment">#获取数据并写入sheet1</span><span class="token keyword">def</span> <span class="token function">get_write_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sheet1_row <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入要爬取&#123;&#125;岗位的页数：'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        url <span class="token operator">=</span> <span class="token string">'https://search.51job.com/list/000000,000000,0000,00,9,99,&#123;&#125;,2,&#123;&#125;.html?lang=c&amp;postchannel=0000&amp;workyear=99&amp;cotype=99&amp;degreefrom=99&amp;jobterm=99&amp;companysize=99&amp;ord_field=0&amp;dibiaoid=0&amp;line=&amp;welfare='</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>job_urlencode<span class="token punctuation">,</span> i<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第&#123;&#125;页的链接是：&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">)</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>  <span class="token comment">#对url发起请求,获取Response对象</span>        response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'gbk'</span>  <span class="token comment">#设置编码格式是gbk</span>        html_51job <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment">#解析获取到HTML</span>        job_script <span class="token operator">=</span> html_51job<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//script[@type="text/javascript"]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text  <span class="token comment"># 获取存放数据的javascript</span>        job_script <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'"engine_search_result":(.*"adid":""&#125;])'</span><span class="token punctuation">,</span> job_script<span class="token punctuation">)</span>  <span class="token comment"># 正则表达式提取数据</span>        job_text <span class="token operator">=</span> job_script<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 得到字符串形式的数据</span>        job_details <span class="token operator">=</span> ast<span class="token punctuation">.</span>literal_eval<span class="token punctuation">(</span>job_text<span class="token punctuation">)</span>  <span class="token comment"># 将字符串转为列表</span>                <span class="token comment"># 将数据循环写入sheet1</span>        <span class="token keyword">for</span> job_details_dict <span class="token keyword">in</span> job_details<span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                job_name <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'job_name'</span><span class="token punctuation">]</span>  <span class="token comment"># 职位名称</span>                company_name <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'company_name'</span><span class="token punctuation">]</span>  <span class="token comment"># 公司名字</span>                wages <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'providesalary_text'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment"># 工资</span>                address <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'workarea_text'</span><span class="token punctuation">]</span>  <span class="token comment"># 地址</span>                updatedate <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'updatedate'</span><span class="token punctuation">]</span>  <span class="token comment"># 发布日期</span>                companytype <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'companytype_text'</span><span class="token punctuation">]</span>  <span class="token comment"># 公司性质</span>                jobwelf <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'jobwelf'</span><span class="token punctuation">]</span>  <span class="token comment"># 职位福利</span>                company_status <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'companyind_text'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment"># 行业)</span>                companysize <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'companysize_text'</span><span class="token punctuation">]</span>  <span class="token comment"># 公司规模</span>                job_href <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'job_href'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment"># 投递链接</span>                company_href <span class="token operator">=</span> job_details_dict<span class="token punctuation">[</span><span class="token string">'company_href'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>  <span class="token comment"># 公司链接</span>                sheet1_row <span class="token operator">=</span> sheet1_row <span class="token operator">+</span> <span class="token number">1</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> job_name<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> company_name<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> wages<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> updatedate<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> companytype<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> jobwelf<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> company_status<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> companysize<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> job_href<span class="token punctuation">)</span>                sheet1<span class="token punctuation">.</span>write<span class="token punctuation">(</span>sheet1_row<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> company_href<span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                <span class="token string">''</span><span class="token keyword">def</span> <span class="token function">spider_51job</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    ceate_sheet<span class="token punctuation">(</span><span class="token punctuation">)</span>    get_write_data<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">#保存excel到该python文件的同一目录下</span>    workbook<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'前程无忧网&#123;&#125;岗位.xls'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'爬取成功'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'------------------------------------------------------'</span><span class="token punctuation">)</span>spider_51job<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>爬取结果部分截图如下：<br><a href="https://imgtu.com/i/hAJ31s"><img src="https://z3.ax1x.com/2021/08/24/hAJ31s.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
